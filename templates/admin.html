<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin • PriceHawk</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  {% if data and data.global_update_running %}
    <meta http-equiv="refresh" content="5">
  {% endif %}
  <style>
    :root{
      --bg:#0f0c29;
      --card-bg: rgba(30,30,50,0.55);
      --border: rgba(255,255,255,0.10);
      --text: rgba(255,255,255,0.95);
      --muted: rgba(255,255,255,0.65);
    }
    *{box-sizing:border-box;}
    body{font-family:'Inter',sans-serif;margin:0;background:var(--bg);color:var(--text);}
    .top{padding:18px 18px;border-bottom:1px solid rgba(255,255,255,0.08);display:flex;align-items:center;justify-content:space-between;gap:12px;}
    .top a{color:#fff;text-decoration:none;font-weight:900;}
    .wrap{max-width:1100px;margin:0 auto;padding:18px;}
    .tabs{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:14px;}
    .tab{padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,0.14);background:rgba(0,0,0,0.20);color:#fff;text-decoration:none;font-weight:850;}
    .tab.active{border-color:rgba(213,51,105,0.4);background:rgba(213,51,105,0.18);}
    .card{background:var(--card-bg);border:1px solid var(--border);border-radius:18px;padding:16px;margin-bottom:14px;}
    .k{color:var(--muted);font-weight:800;}
    .v{font-weight:950;}
    table{width:100%;border-collapse:collapse;}
    th,td{padding:10px;border-bottom:1px solid rgba(255,255,255,0.08);text-align:left;font-size:.95rem;}
    th{color:var(--muted);font-weight:900;}
    .badge{padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,0.18);background:rgba(0,0,0,0.18);font-weight:900;font-size:.82rem;white-space:nowrap;display:inline-block;}
  </style>
</head>
<body>
  <div class="top">
    <div style="font-weight:950;">Admin</div>
    <a href="{{ url_for('index') }}">Back to dashboard</a>
  </div>

  <div class="wrap">
    <div class="tabs">
      <a class="tab {{ 'active' if tab=='dashboard' else '' }}" href="{{ url_for('admin_portal', tab='dashboard') }}">Dashboard</a>
      <a class="tab {{ 'active' if tab=='active_users' else '' }}" href="{{ url_for('admin_portal', tab='active_users') }}">Users</a>
      <a class="tab {{ 'active' if tab=='pending_users' else '' }}" href="{{ url_for('admin_portal', tab='pending_users') }}">Pending ({{ pending_count }})</a>
    </div>

    {% if tab == 'dashboard' %}
      <div class="card">
        <div style="display:flex;gap:18px;flex-wrap:wrap;">
          <div><div class="k">Total users</div><div class="v">{{ data.total_users }}</div></div>
          <div><div class="k">Total items</div><div class="v">{{ data.total_items }}</div></div>
          <div><div class="k">Update interval</div><div class="v">{{ data.update_interval_minutes }} min</div></div>
        </div>
      </div>

      {% if data.global_update_running %}
        <div class="card">
          <div style="font-weight:950;margin-bottom:6px;">Next in: Updating ( {{ data.global_update_done }} of {{ data.global_update_total }} )</div>
          <div style="color:var(--muted);font-weight:800;">Current ASIN: {{ data.global_update_current_asin }}</div>
          <div style="color:var(--muted);font-size:.9rem;margin-top:8px;">This page refreshes automatically until the update completes.</div>
        </div>
      {% endif %}

      <div class="card">
        <div class="k">System announcement</div>
        <div class="v" style="margin-top:6px;">{{ data.announcement if data.announcement else '—' }}</div>
      </div>

    {% else %}
      <div class="card">
        <table>
          <thead>
            <tr>
              <th>Email</th>
              <th>Role</th>
              <th>Approved</th>
              <th>Telegram</th>
              <th>Created</th>
            </tr>
          </thead>
          <tbody>
            {% for u in data.users %}
              <tr>
                <td>{{ u.email }}</td>
                <td>{{ u.role }}</td>
                <td>{{ 'Yes' if u.is_approved else 'No' }}</td>
                <td>
                  {% if u.telegram_chat_id %}
                    <span class="badge" style="color:#2ee59d;border-color:rgba(46,229,157,0.35);background:rgba(46,229,157,0.10);">Active</span>
                  {% else %}
                    <span class="badge" style="color:#f59e0b;border-color:rgba(245,158,11,0.35);background:rgba(245,158,11,0.10);">Pending</span>
                  {% endif %}
                </td>
                <td>{{ u.created_at }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% endif %}
  </div>
</body>
</html>
