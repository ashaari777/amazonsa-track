<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Price monitoring ‚Ä¢ PriceHawk</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0f0c29;
      --card: rgba(30,30,50,0.55);
      --border: rgba(255,255,255,0.10);
      --text: rgba(255,255,255,0.95);
      --muted: rgba(255,255,255,0.65);
      --good:#2ee59d;
      --warn:#ffcc66;
      --bad:#ff5a7a;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Arial;background:var(--bg);color:var(--text);min-height:100vh;padding:18px}
    .top{max-width:980px;margin:0 auto 14px auto;display:flex;align-items:center;justify-content:space-between;gap:12px}
    .top h1{margin:0;font-size:20px;font-weight:900;letter-spacing:.2px}
    .top a{color:var(--muted);text-decoration:none;font-weight:700}
    .grid{max-width:980px;margin:0 auto;display:grid;grid-template-columns:repeat(auto-fit,minmax(270px,1fr));gap:14px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:18px;padding:14px;backdrop-filter: blur(10px)}
    .name{font-weight:900;font-size:14px;line-height:1.25;max-height:3.2em;overflow:hidden}
    .price{margin-top:10px;display:flex;align-items:center;gap:10px;flex-wrap:wrap}
    .pill{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--border);padding:8px 10px;border-radius:999px;font-weight:900;font-size:13px}
    .pill.good{border-color:rgba(46,229,157,0.35);color:var(--good)}
    .pill.warn{border-color:rgba(255,204,102,0.35);color:var(--warn)}
    .pill.bad{border-color:rgba(255,90,122,0.35);color:var(--bad)}
    .btnrow{margin-top:12px;display:flex;gap:10px;flex-wrap:wrap}
    .btn{display:inline-flex;align-items:center;justify-content:center;border-radius:12px;padding:10px 12px;font-weight:900;font-size:13px;text-decoration:none;border:1px solid var(--border);color:var(--text);background:rgba(0,0,0,0.18);cursor:pointer}
    .btn:hover{background:rgba(255,255,255,0.06)}
    .btn.delete{border-color:rgba(255,90,122,0.35);color:var(--bad)}
    .muted{color:var(--muted);font-size:12px;margin-top:8px}
    form{margin:0}
  </style>
</head>
<body>
  <div class="top">
    <h1>ü¶Ö Price monitoring</h1>
    <a href="{{ url_for('index') }}">‚Üê Back to Dashboard</a>
  </div>

  <div class="grid">
    {% for it in items %}
      <div class="card">
        <div class="name">{{ it.name }}</div>

        <div class="price">
          <span class="pill">{{ it.current_price_text }}</span>
          {% if it.status.startswith('Congrats') %}
            <span class="pill good">{{ it.status }}</span>
          {% else %}
            <span class="pill warn">{{ it.status }}</span>
          {% endif %}
        </div>

        {% if it.reached_at %}
          <div class="muted">Target reached at: <span class="local-dt" data-iso="{{ it.reached_at.isoformat() if it.reached_at else '' }}"></span></div>
        {% endif %}

        <div class="btnrow">
          <!-- Keep buttons order: Status | Open | Delete (Status is above as a pill) -->
          <a class="btn" href="{{ it.url }}" target="_blank" rel="noopener">Open</a>

          <form action="{{ url_for('delete', asin=it.asin) }}" method="POST" onsubmit="return confirm('Delete this item?');">
            <button class="btn delete" type="submit">Delete</button>
          </form>
        </div>
      </div>
    {% endfor %}
  </div>

  <script>
    // Convert server ISO timestamps to local device time
    document.querySelectorAll('.local-dt').forEach(el => {
      const iso = el.getAttribute('data-iso');
      if(!iso){ el.textContent=''; return; }
      const d = new Date(iso);
      if (isNaN(d.getTime())) { el.textContent = iso; return; }
      el.textContent = d.toLocaleString();
    });
  </script>
</body>
</html>
